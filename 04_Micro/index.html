<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>PS70: TDK</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=https://fonts.googleapis.com/css?family=Inconsolata:400,500,600,700|Raleway:400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css"
    />

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/prism.min.js"></script> -->

<link
rel="stylesheet"
href="../Prism/prism.css"
/>

<script src="../Prism/prism.js"></script>

  <!-- =======================================================
  * Template Name: MyPortfolio - v4.9.0
  * Template URL: https://bootstrapmade.com/myportfolio-bootstrap-portfolio-website-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
     .auto-resizable-iframe {
      max-width: 1000px;
      margin: 0px auto;
    }

    .auto-resizable-iframe > div {
      position: relative;
      padding-bottom: 75%;
      height: 0px;
    }

    .auto-resizable-iframe iframe {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
    }
  </style>


</head>

<body>

  <!-- ======= Navbar ======= -->
  <div class="collapse navbar-collapse custom-navmenu" id="main-navbar">
    <div class="container py-2 py-md-5">
      <div class="row align-items-start">
        <div class="col-md-2">
          <ul class="custom-menu">
            <li class="active"><a href="../index.html">Projects</a></li>
            <li><a href="../about.html">About Me</a></li>
            <li><a href="../contact.html">Contact</a></li>
          </ul>
        </div>
        <div class="col-md-6 d-none d-md-block  mr-auto">
          <div class="tweet d-flex">
            <div>
              <p><em>Welcome to my PS70 portfolio! I hope you enjoy learning more about my project for PS70: Intro to Digital Fabrication.</em></p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <nav class="navbar navbar-light custom-navbar">
    <div class="container">
      <a class="navbar-brand" href="../index.html">PS70: Intro to Digital Fabrication</a>
      <a href="#" class="burger" data-bs-toggle="collapse" data-bs-target="#main-navbar">
        <span></span>
      </a>
    </div>
  </nav>


  <!-- ======= Main Content======= -->

   <main id="main">


    <section class="section">
      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up">
            <h2>04: Microcontroller Programming</h2>
          </div>
        </div>
      </div>


      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up" data-aos-delay="100">
            <p>This week, I wanted to start making progress towards my final project by exploring how we can make theremin-like systems using the Arduino. This happened over three iterations, ending with a basically functional theremin with volume and pitch control. Click the links below for details:</p>
            <ul>
                <li><a href="#misc">Misc : Soldering and 3D Printing</a></li>
                <li><a href="#tutorial">Arduino Tutorial : Light Theremin</a></li>
                <li><a href="#theremin-v1">Ultrasensor Theremin V1</a></li>
                <li><a href="#theremin-v2">Ultrasensor V2 : 2 There 2 Min</a></li>
                <li><a href="#examples">The Theremin in Action</a></li>
            </ul>
          </div>
          <div class="col-md-1" data-aos="fade-up"></div>
        </div>
      </div>

      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up" data-aos-delay="100">
            <h3 class="h3" id="misc">Misc : Soldering and 3D Printing</h3>
            <h5 class="h5">3D Printing</h5>
            <p>In lab, we were able to experiment with printing a tiny part (~5 min) on the 3D printers. I looked around Thingiverse for a bit for a cool-looking model, and eventually settled on this <a href="https://www.thingiverse.com/thing:5371468">infinity cube</a> by Eevee97. However, to make it print in 5 minutes, I just scaled it down to like 10% scale.</p>
            <div class="row mx-auto" style="max-width: 100%;">
                <div class="col-md-4">
                  <img src="images/infinity_cube.png" alt="My first soldering job." class="img-fluid" style="max-width: 100%;">
                </div>
            </div>
            <p>I thought that maybe there were 80/20 odds that scaling it down so much would really break something. Turns out, the odds were more like 100/0, and the result was basically a rectangle:</p>
            <div class="row mx-auto" style="max-width: 100%;">
                <div class="col-md-4">
                  <img src="images/3d-print.jpg" alt="My first soldering job." class="img-fluid" style="max-width: 100%;">
                </div>
            </div>
            <p>The moral of the story: you can't just rescale things whenever you want.</p>

            <h5 class="h5">Soldering</h5>
            <p>I also ended up doing a little soldering. Initially I was trying to follow the Arduino theremin tutorial, and so I grabbed a part called a piezo that had two small wires at the end that wouldn't fit into the premade sockets. To fix this, I finally tried out soldering (I didn't get around to it last week), and was pleasently surprised that nothing went terribly wrong:</p>
            <div class="row mx-auto" style="max-width: 100%;">
                <div class="col-md-4">
                  <img src="images/soldering.jpg" alt="My first soldering job." class="img-fluid" style="max-width: 100%;">
                </div>
            </div>
            <p>However, though the soldering was a success, I had still made a critical mistake---it turns out that the "piezo" that I had found was completely unrelated to the piezo part that I actually needed, which was more like a speaker. Bobby helped me figure this out pretty fast, but now I just have this component connected to two wires, and I don't even know what the component is. You win some, you lose some.</p>
          <div class="col-md-1" data-aos="fade-up"></div>
        </div>
      </div>

      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up" data-aos-delay="100">
            <h3 class="h3" id="tutorial">Arduino Tutorial : Light Theremin</h3>
            <p>This week, I wanted to focus on getting better at electronics and to start figuring out what making a theremin circuit could look like. As a jumping-off point, I saw a tutorial in the <a href="https://www.eitkw.com/wp-content/uploads/2020/03/Arduino_Projects_Book.pdf">Arduino projects book</a> for a "light theremin," which uses a photoresistor to control the pitch of a speaker.</p>
            <p>The circuit is super simple. You have a speaker which is plugged into some PWM pin and to ground, and you have a photoresistor connected in the same way. The idea is that when the photoresistor sees different amounts of light, it should send a different signal, which we can map to pitch frequency.</p>
            <div class="row mx-auto" style="max-width: 100%;">
                <div class="col-md-4">
                  <img src="images/circuit_1.png" alt="My first soldering job." class="img-fluid" style="max-width: 100%;">
                </div>
            </div>
            <p>The circuit and code didn't too tricky, but I still got pretty terrible results that sounded mostly like noise :</p>
            <div class="auto-resizable-iframe">
                <div>
                  <iframe frameborder="0" allowfullscreen="" src="images/photo_theremin.mp4"></iframe>
                </div>
            </div>
            <p>There are a few possible reasons for this. For one, I definitely could've messed something up that I didn't think of. Still, another reason for this that I noticed was basically that the photoresistor was super sensitive to light---like any light it saw would give the max signal, and then even completely covering it with a dark material would only lower its signal to like 80% it's max value. This made it pretty much impossible to use as a theremin analogue, so I decided to ask Bobby for some advice for the next iteration.</p>
          <div class="col-md-1" data-aos="fade-up"></div>
        </div>
      </div>

      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up" data-aos-delay="100">
            <h3 class="h3" id="theremin-v1">Ultrasensor Theremin V1</h3>
            <p>Bobby told me about this component called an <a href="https://howtomechatronics.com/tutorials/arduino/ultrasonic-sensor-hc-sr04/">Ultrasonic Sensor</a>, which can calculate to reasonably high precision the distance from a sensor to the nearest solid object. It works by having two microphones---one sends out a super high-frequency signal, and the other listens to hear it reflected back, recording how long it takes to hear something along the way. This path basically gives you an equilateral triangle with a known base (the microphone distance) and a time signal proportional to the path travelled (two times the other side length). So we can do some basic algebra to get out the distance in whatever units we want.</p>
            
            <p>Bobby's idea was to substitute the photoresistor from the Arduino tutorial with one of these ultrasensors and see what happens. After doing that, we had a much better theremin:</p>
            <div class="auto-resizable-iframe">
                <div>
                  <iframe frameborder="0" allowfullscreen="" src="images/ultrasensor_ex.mp4"></iframe>
                </div>
            </div>
            
            <p>There were still a few small issues---most notably, there's a lot of noise in the distance measurements, so you don't get a consistent tone if you hold your hand in the same place. I think this could be pretty easily solved by averaging over multiple signals to decide the tone, but I didn't have time to implement it this week. More pressing was that this still isn't a full theremin---for that, I need to be able to control both pitch and volume.</p>
        </div>
        <div class="col-md-1" data-aos="fade-up"></div>
      </div>

      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up" data-aos-delay="100">
            <h3 class="h3" id="theremin-v1">Ultrasensor Theremin V2 : 2-Ther-e, 2-Min</h3>
            <p>The general idea behind getting the second theremin to work was pretty simple---pop in a second ultrasensor in a different place, and map its signal to volume. Luckily, unlike the standard <code>tone</code> function, there's a library called <a href="https://github.com/connornishijima/arduino-volume3">Volume3</a> by Connor Nishijima that lets you set both the pitch and volume of an output speaker. Here's what my hardware setup looked like:</p>
            <div class="row mx-auto align-items-center" style="max-width: 100%;">
                <div class="col-md-5 align-items-center">
                  <img src="images/theremin2_proto.jpg" alt="My final theremin prototype." class="img-fluid" style="max-width: 100%;">
                </div>
            </div>
            <p>I tried for a while to parallelize the process of sending and receiving the ultrasensor signals by putting them into a class and creating "phases" where they wait until a certain time has passed to perform the next operation, but this didn't really work. Eventually, I just tried to make a basic ultrasensor class and read each of there signals in the inner loop, and this worked totally fine. I guess that they're sent and received fast enough that it doesn't matter whether they're parallelized. Another lesson: always try the dumb solution first in case it just works out.</p>
            <p>The only other notable change is that I was able to get a more smooth transition between pitches by changing the <code>map</code> function to work on floats. Ints basically truncated all the information between scales, so I could only map very specific distance measurements to pitches. Finally, I just found a box of clay in one of the bins and taped an ultrasensor to each side to get my final prototype:</p>
            <div class="row mx-auto" style="max-width: 100%;">
                <div class="col-md-4">
                  <img src="images/theremin2_final_1.jpg" alt="A planet gear." class="img-fluid" style="max-width: 100%;">
                </div>
                <div class="col-md-4">
                    <img src="images/theremin2_final_2.jpg" alt="A gear sliding across a rack." class="img-fluid" style="max-width: 100%;">
                  </div>
                  <div class="col-md-4">
                    <img src="images/theremin2_final_3.jpg" alt="A gear sliding across a rack." class="img-fluid" style="max-width: 100%;">
                  </div>
            </div>
            <p>Here's my final code: </p>
            <pre>
                <code class="language-clike">
#include "Volume3.h" // Include the Volume library
#define speakerPin 9

// Ultrasensor class
class ultraSensor {
    int trigPin;
    int echoPin;
    // Tells where we should stop growing the signal (sensitivity parameter)
    float highBound;

    public:
    ultraSensor(int tPin, int ePin, float bound) {
        trigPin = tPin;
        echoPin = ePin;
        pinMode(trigPin, OUTPUT);
        pinMode(echoPin, INPUT);
        highBound = bound;
    }

    // Collect a distance reading from the ultrasensor, in cm (I think)
    float readTone() {
        digitalWrite(trigPin, LOW);
        delayMicroseconds(2);
        digitalWrite(trigPin, HIGH);
        delayMicroseconds(10);
        digitalWrite(trigPin, LOW);
        float duration = pulseIn(echoPin, HIGH);
        float distance = duration * .034  / 2;

        // Truncate the reading above a certain threshold
        if (distance > highBound) {
        distance = highBound;
        }

        return(float(distance));
    }
};

// This is just map, but it doesn't truncate floats
long float_map(float x, float in_min, float in_max, float out_min, float out_max)
{
    return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}

// Define one ultrasensor looking for pitch, and another looking for volume
float volBound = 10.0;
float pitchBound = 50.0;
ultraSensor pitchSensor(3,5, pitchBound);
ultraSensor volSensor(10, 11, volBound);

void setup() {
}

void loop() {
    // Grab the distance measurements from each sensor
    float pitch_raw = pitchSensor.readTone();
    float vol_raw = volSensor.readTone();

    // Map each distance to a valid pitch or volume
    float pitch = float_map(pitch_raw, 0, pitchBound, 200, 1500);
    float volume = float_map(vol_raw, 0, volBound, 0, 1023);

    vol.tone(speakerPin, pitch, volume);
    // vol.tone doesn't have a time parameter like the normal tone() function, so you have to add some delay for the sound to persist
    delay(2);
}
                </code>
            </pre>
          <div class="col-md-1" data-aos="fade-up"></div>
        </div>
      </div>


      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-12" data-aos="fade-up" data-aos-delay="100">
            <h3 class="h3" id="examples">Theremin in Action</h3>
            <p>We now have a (mostly) functional theremin! Here's a video of me trying to play mary had a little lamb : </p>
            <div class="auto-resizable-iframe">
                <div>
                  <iframe frameborder="0" allowfullscreen="" src="images/theremin_song_1.mp4"></iframe>
                </div>
            </div>
            <p>And here's Chris trying much more successfully to play the Blue Danube :</p>
            <div class="auto-resizable-iframe">
                <div>
                  <iframe frameborder="0" allowfullscreen="" src="images/theremin_song_2.mp4"></iframe>
                </div>
            </div>
            <p>Anyways, that's it for this week. Overall I feel pretty satisfied with how it turned out! It's worth noting, though, that this is actually really unlike how a real theremin functions---I still have a lot left to learn about that actual cirucit. See you next week.</p>
            <p>&mdash;Thomas</p>
          <div class="col-md-1" data-aos="fade-up"></div>
        </div>
      </div>


    </section>


  </main><!-- End #main -->


  <!-- ======= Footer ======= -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="row">
        <div class="col-sm-6">
          <p class="mb-1">Template Credit : Felicia Liang , PS70 Fall 2022</p>
          </div>
        <div class="col-sm-6 social text-md-end">
          <a href="https://www.instagram.com/wanderies_/"><span class="bi bi-instagram"></span></a>
          <a href="https://www.linkedin.com/in/feliciasliang/"><span class="bi bi-linkedin"></span></a>
        </div>
      </div>
    </div>
  </footer>


  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

</body>

</html>